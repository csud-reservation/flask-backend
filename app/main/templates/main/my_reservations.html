{% extends "base.html" %}
{% block title %}Mes réservations{% endblock %}

{% block content %}
  <div class="container">
    <div class="row">
      <div class="col-lg-offset-1 col-md-offset-1 col-md-10 col-lg-10 blanc espace_dessous col-lg-offset-1">
        {% if just_reserved %}
          <center>
            <div class="alert alert-success">
              Votre réservation a bien été effectuée.
            </div>
          </center>
        {% endif %}
        <center>
          <div class="alert alert-success hidden" id="res_deleted_message">
            Votre réservation a bien été supprimée.
          </div>
        </center>
        <h1 class="gros_titre">Mes réservations</h1>
        
          
          <table class="table table-striped">
              <th>Date de début</th>
              <th>Date de fin</th>
              <th>Salle</th>
              <th>Heure de début</th>
              <th>Heure de fin</th>
              <th>Raison</th>
              <th>Groupe d'étudiants</th>
              <th></th>
            <tbody>
              {% for res in reservations %}
              {% set timeslots = res.timeslots.all() %}
              
              {% if today <= res.end_date %}
                <tr>
              {% else %}
                <tr class="disabled_res">
              {% endif %}
                  <td class="date_format">{{res.start_date}}</td>
                  <td class="date_format">{{res.end_date}}</td>
                  <td>{{res.room.name}}</td>
                  <td>{{res.timeslots.first().start_time}}</td>
                  <td>{{timeslots[timeslots|length-1].end_time}}</td>
                  <td>{{res.reason_details}}</td>
                  <td>{{res.student_group}}</td>
                  {% if today <= res.end_date %}
                  <td id={{res.id}}><button class="btn btn-xs btn-danger delete"><span class="glyphicon glyphicon-trash"></span> </button>
                  <button class="btn btn-xs btn-primary update"><span class="glyphicon glyphicon-refresh"></span> </button></td>
                  {% else %}
                  <td></td>
                  {% endif %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
            
            <!-- Modal -->
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Annulation de la reservation</h4>
                  <div class="modal-body">
                    <p>Êtes-vous certain de vouloir annuler la réservation suivante : </p></br>
                    <div id="deletedReservation"></div>

                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" aria-label="Retour">Retour</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" id="deleteButton">Confirmer l'annulation</button>
                  </div>
                </div>
              </div>
            </div>
        </div>
        
        
      </div>
    </div class="col-lg-2 col-md-1"></div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<link rel="stylesheet" href="{{ url_for('static', filename='my_reservations.css') }}">
{{ super() }}
<script src="{{ url_for('static', filename='my_reservations.js') }}"></script>
{% endblock %}